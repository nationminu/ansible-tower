# ANSIBLE VAULT

> 번수 및 파일을 암호화 하는데 사용.
   
## 1. Vault password

> vault password 는 ansible vault 에서 암/복호화에 사용되는 key 값이다.

### 1. Prompt

> **--ask-vault-pass** : 암/복호화 또는 playbook 실행시 매번 prompt로 입력 받는다.

- admin.yaml 생성
```bash
# ansible-vault create admin.yaml --ask-vault-pass
New Vault password: 
Confirm New Vault password: 
```
- editor 로 사용자 정보 입력 
```yaml
---
username: admin
password: P@ssW0rd
...
```
- admin.yaml 암호화 확인
```bash
# cat admin.yaml
$ANSIBLE_VAULT;1.1;AES256
31323934653362363830306533666332323461383534623237633563653333653134306333313065
6136376233316437366237383235613362613938303838370a656162373062643737356139343831
61343331386136303834633665353038626339303335383032303364346264393438643531663131
6166316261343838620a343834313930333838333361383761316434323639666666653866656563
34646663646532383035626232376535363534336464636639366533303838383264323963626538
6331653731636633346661323339663035343062343462616436
```


### 2. File

> **--vault-id / --vault-password-file** : 암/복호화 또는 playbook 실행시 파일의 내용을 사용한다.

- vault password file 생성
```bash
# echo "Super P@wer P@ssW0rd V0ult" > ansible.vault
```
- guest.yaml 생성
```bash
# ansible-vault create guest.yaml  --vault-password-file ansible.vault
```
- editor 로 사용자 정보 입력 
```yaml
---
username: guest
password: P@ssW0rd
...
```
- guest.yaml 암호화 확인
```bash
# cat guest.yaml
$ANSIBLE_VAULT;1.1;AES256
35313366333930316566303461623266663335313662636535333862616534666239613831366637
3062376664323136313630313930393266633262666139330a336235326434636431333431373362
38653130313539616465643833633736653032613037646364333332373764656433363966303131
6334613137373464390a336263393238326134633137376230323762383931653235333635306637
32306630623862613233313366383633393032383962623930616133623263306665616166626631
3335653539386331663337633364343330333731653530653465
```


## 2. Variable Encrytion

> Yaml 파일의 변수 값을 암호화한다.

### 1. Encription

> ansible vault "encrypt_string" 옵션으로 값을 암호화하면 콘솔에 결과가 출력된다.

- username 값 암호화
```bash
# ansible-vault encrypt_string 'user1' --name 'username' --vault-password-file ansible.vault
username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63343163393163336531616264353066323763333235336363643536623333326633343430326663
          6633383135613161616334383936653935383563663633310a643238363939343566383138633562
          66373430396436346431313638373661323632613330373866346136656266346335393232376563
          6130363038336337620a343765613065336464303139303337326161323033623133333262613230
          6265
Encryption successful
```
- password 값 암호화
```bash
# ansible-vault encrypt_string 'P@ssw0rd' --name 'password' --vault-password-file ansible.vault
password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34363333663565343733616539616362613836323464383034336136656531383238333364313963
          6537613830373034643035363738303738613335346336320a613262343135383832376137666634
          30636238366165336164663762623230333634373733646537626630336266393437393564663061
          3538336464343839320a333561313039366332366563653231376538653635616566356639303833
          3432
Encryption successful
```

- 암호화된 username / password 값으로 user.yaml 파일 생성한다.
```yaml
---
username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63343163393163336531616264353066323763333235336363643536623333326633343430326663
          6633383135613161616334383936653935383563663633310a643238363939343566383138633562
          66373430396436346431313638373661323632613330373866346136656266346335393232376563
          6130363038336337620a343765613065336464303139303337326161323033623133333262613230
          6265
password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34363333663565343733616539616362613836323464383034336136656531383238333364313963
          6537613830373034643035363738303738613335346336320a613262343135383832376137666634
          30636238366165336164663762623230333634373733646537626630336266393437393564663061
          3538336464343839320a333561313039366332366563653231376538653635616566356639303833
          3432      
...
```

### 2. Decription

> ansible debug 모듈을 이용하여 복호화한다.

```bash
# ansible localhost -m debug -a var="username" -e "@user.yaml" --vault-password-file ansible.vault
localhost | SUCCESS => {
    "username": "user1"
}
# ansible localhost -m debug -a var="password" -e "@user.yaml" --vault-password-file ansible.vault
localhost | SUCCESS => {
    "username": "P@ssW0rd"
}
```

## 3. File Encryption


### 1. Encription

### 2. Decription



> **:link: Referer** : 
> https://docs.ansible.com/ansible/latest/user_guide/vault.html
